<html>

<head>
  <style>
    #container{
      min-height: 50%;
      max-width: 50%;
    }

    .hidden{
      display: none;
    }

    .hover{
      display: inline;
    }
  </style>
  
  <script>
    var DEFAULT_PERCENT = 25;
    var PERCENT_STEP = 0.1;

    var DEFAULT_X = 0;
    var DEFAULT_Y = 0;

    var DEFAULT_DX = 1;
    var DEFAULT_DY = 2;

    // Position for x,y.
    var x = DEFAULT_X;
    var y = DEFAULT_Y;

    // every dt ms translate the backgrounds x by dx and y by dy.
    var dx = DEFAULT_DX; 
    var dy = DEFAULT_DY;
    var dt = 20; 

    var container;
    var rawr;
    var tracking;

    var gif_index = 0;
    var GIF_URLS = [
      "http://31.media.tumblr.com/37b83fc62c74feca10eabdd949db2e09/tumblr_mzq5d8uiFD1six59bo1_400.gif",
      "http://25.media.tumblr.com/761e32af86895cf7c1be483932bc5a71/tumblr_mvrw6iuSHS1rilp8po1_500.gif",
      "http://31.media.tumblr.com/cdad06a09d2a180fc1138d6cade190b7/tumblr_mvwfotFHgX1rilp8po1_500.gif",
      "http://25.media.tumblr.com/fb94197e2f8f47366b5ccf3309122fa6/tumblr_mzre7ufgqq1sso6sco1_500.gif",
      "http://31.media.tumblr.com/761037ef4d5f78adda24ca6dd0175eac/tumblr_mzdp4uLeBF1rilp8po1_500.gif",
      "http://31.media.tumblr.com/217415631a8b6aa999a100c2d0bc0cb7/tumblr_myyii2w2v01rilp8po1_500.gif",
      "http://31.media.tumblr.com/a31a91541758b95ea81907b7539f4ff9/tumblr_mryp2oe4UB1qfjvexo1_500.gif",
      "http://24.media.tumblr.com/5cfb4463a5b7484d7cdbdcb61271c495/tumblr_mpylwuRedl1qfjvexo1_500.gif",
      "http://25.media.tumblr.com/fc9b9d47fe285620b55b237834d63d08/tumblr_mlgbscgSMu1qfjvexo1_500.gif",
      "http://31.media.tumblr.com/bf994f4769819676dabae3452e5d126c/tumblr_mk8v5qxfZe1qfjvexo1_500.gif",
      "http://24.media.tumblr.com/5e911cb45795fee8d59f83d62cfcbbfc/tumblr_mfmk4lREqB1qfjvexo1_500.gif",
      "http://25.media.tumblr.com/tumblr_me70b6T4Nx1qfjvexo1_500.gif",
      "http://24.media.tumblr.com/tumblr_mdv6wykYMz1qfjvexo1_500.gif",
      "http://24.media.tumblr.com/tumblr_ma28naYTFd1qfjvexo1_500.gif",
      "http://24.media.tumblr.com/tumblr_m6q28aZ30c1qfjvexo1_500.gif",
      "http://31.media.tumblr.com/tumblr_m631bmEnX51qfjvexo1_500.gif",
    ];

    var gif_index_min = 0;
    var gif_index_max = GIF_URLS.length-1;

    var translate_interval;

    //var percent = DEFAULT_PERCENT;
    var hpercent = DEFAULT_PERCENT;
    var vpercent = DEFAULT_PERCENT;


    function init() {
      container = document.getElementById("container");
      rawr = document.getElementById("rawr");

      setListGif();

      container.onmouseover = function() {
        
        var inner = document.getElementById("controls");
        inner.classList.add("hover");
        
      };

      container.onmouseout = function() {
        var inner = document.getElementById("controls");
        inner.classList.remove("hover");
      };

    }

    function setManualGif() {
      url = document.getElementById("area").value;

      GIF_URLS.push(url);
      rawr.style.backgroundImage = "url("+url+")";
      setBackgroundImageFromUrl(url);
    }

    function setListGif() {
      setBackgroundImageFromUrl(GIF_URLS[gif_index]);
    }

    function setBackgroundImageFromUrl(url) {
      rawr.style.backgroundImage = "url("+url+")";
    }

    function minus() {
      hpercent *= (1 - PERCENT_STEP);
      vpercent *= (1 - PERCENT_STEP);
      set_backgroundSize(hpercent, vpercent);
    }

    function plus() {
      hpercent *= (1 + PERCENT_STEP);
      vpercent *= (1 + PERCENT_STEP);
      set_backgroundSize(hpercent, vpercent);
    }

    function horiz() {
      set_backgroundSize("100%", vpercent);
    }

    function verti() {
      set_backgroundSize(hpercent, "100%");
    }

    function full() {
      set_backgroundSize("100%", "100%");
    }

    function set_backgroundSize(hpercent, vpercent) {
      rawr.style.backgroundSize = ""+hpercent+"% "+vpercent+"%";
    }

    function next_gif() {
      if (gif_index < gif_index_max){
        gif_index++;
      } else {
        gif_index = gif_index_min;
      }

      setListGif();
    }

    function prev_gif() {
      if (gif_index > gif_index_min){
        gif_index--;
      } else {
        gif_index = gif_index_max;
      }

      setListGif();
    }

    function nozoom() {
      rawr.style.backgroundSize = "";

      tracking = false;
      stopmovingit();

      x = DEFAULT_X;
      y = DEFAULT_Y;

      dx = DEFAULT_DX;
      dy = DEFAULT_DY;

      hpercent = DEFAULT_PERCENT;
      vpercent = DEFAULT_PERCENT;

      drawxy();
    }

    function drawxy() {
      // This is a bit of a misnomer, nothing is really being "drawn" but it makes sense kind of
      draw(x,y);
    }

    function draw(_x,_y) {
        rawr.style.backgroundPositionY = _y+"px";
        rawr.style.backgroundPositionX = _x+"px";      
    }

    function moveit() {
      moving = true;

      if (translate_interval){
        dx *= 1.5;
        dy *= 1.5;
      } else {
        translate_interval = window.setInterval(function(){
          if (moving){
            x += dx; 
            y += dy; 
            drawxy();
          }
        }, dt);
      }
    }

    function stopmovingit() {
      clearInterval(translate_interval);
      moving = false;
      translate_interval = null;
    }

    function trackit() {
      tracking = !tracking;
    }

  </script>
  <script>
    var key_function_mappings = {
      "M" : moveit,
      "S" : stopmovingit,
      "T" : trackit,
      "N" : next_gif,
      "P" : prev_gif,
      "H" : horiz,
      "V" : verti,
      "F" : full,
      "0" : nozoom,
      "%" : function() { dx /= 1.5; drawxy(); }, // left arrow
      "'" : function() { dx *= 1.5; drawxy(); }, // right arrow
      "(" : function() { dy *= 1.5; drawxy(); }, // up arrow
      "&" : function() { dy /= 1.5; drawxy(); }, // down arrow
      187 : plus,  // This is stupid. (-)
      189 : minus, // This is stupid. (=)
    };

    function keystroke(e){
      // High ascii is being all shitty so this tries to look up codes if it can't find the character.
      keyChar = String.fromCharCode(e.keyCode);
      if ( key_function_mappings.hasOwnProperty(keyChar) ){
        key_function_mappings[keyChar]();
      } else if (key_function_mappings.hasOwnProperty(e.keyCode)) {
        key_function_mappings[e.keyCode]();
      }
    }

    function mousemove(e){
      if (tracking){
        y = e.y;
        x = e.x; 
        drawxy();
      }
    }

  </script>
</head>

<body 
  id="rawr" 
  onload="init();" 
  style="background-image: url('http://upload.wikimedia.org/wikipedia/commons/4/42/Loading.gif'); background-color: black"
  onkeydown=keystroke(event)
  onmousemove=mousemove(event)
>
  <div id="container">
    <div class="hidden" id="controls">
      <textarea id="area" onchange="setManualGif()"></textarea>
      <br>
      <button id="next" onclick="next_gif()">Next gif (N)</button>
      <button id="prev" onclick="prev_gif()">Previous gif (P)</button>
      <br>
      <button id="minus" onclick="minus()">Zoom out (-)</button>
      <button id="plus" onclick="plus()">Zoom in (+)</button>
      <button id="nozoom" onclick="nozoom()">No Zoom (0)</button>
      <br>
      <button id="horiz" onclick="horiz()">Horz (H)</button>
      <button id="verti" onclick="verti()">Vert (V)</button>
      <button id="full" onclick="full()">Full (F)</button>
      <br>
      <button id="moveit" onclick="moveit()">Move It (M)</button>
      <button id="stopit" onclick="stopmovingit()">Stop it (S)</button>
      <br>
      <button id="trackit" onclick="trackit()">Toggle Mouse Tracking (T)</button>
    </div>
  </div>
</body>
</html>
